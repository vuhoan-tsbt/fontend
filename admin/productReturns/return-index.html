<div ng-show="isLoading" class="loading">
    <div class="spinner-border text-primary spinner-center" role="status">
    </div>
</div>

<h2 class="text-uppercase mt-2 mb-3">Trả hàng</h2>

<!-- Button trigger modal -->
<button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#modalProductReturn"
    ng-click="openModelChooseBill()">
    <i class="bi bi-plus"></i> Tạo mới
</button>

<ul class="nav nav-tabs mt-5" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button"
            role="tab" aria-controls="home-tab-pane" aria-selected="true" ng-click="findBillByWaitConfirmReturn()">Chờ
            xác nhận trả hàng <i class="bi bi-arrow-repeat"></i></button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button"
            role="tab" aria-controls="profile-tab-pane" aria-selected="false" ng-click="findBillByCancelReturn()">Từ
            chối trả hàng <i class="bi bi-arrow-repeat"></i></button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button"
            role="tab" aria-controls="contact-tab-pane" aria-selected="false" ng-click="findBillBySuccessReturn()">Đổi
            trả thành công <i class="bi bi-arrow-repeat"></i></button>
    </li>
</ul>

<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
        <div ng-include="'/admin/productReturns/tab-product-return.html'"></div>
    </div>
    <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
        <div ng-include="'/admin/productReturns/tab-product-return.html'"></div>
    </div>
    <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
        <div ng-include="'/admin/productReturns/tab-product-return.html'"></div>
    </div>
</div>



<!-- modalProductReturn -->
<div class="modal fade" id="modalProductReturn" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Chọn hóa đơn trả hàng</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div ng-if="listBillEligibleForReturn.length <= 0" class="alert alert-danger" role="alert">
                    {{listEmptyForReturn}}
                </div>
                <div ng-if="listBillEligibleForReturn.length > 0" class="table-responsive border rounded mt-5"
                    style="max-height: 400px; overflow: auto;">
                    <table class="table table-bordered">
                        <thead>
                            <tr style="position: sticky; top: 0;">
                                <th class="text-center bg-light">Mã HĐ</th>
                                <th class="text-center bg-light">Khách hàng</th>
                                <th class="text-center bg-light">Số điện thoại</th>
                                <th class="text-center bg-light">Nhân viên</th>
                                <th class="text-center bg-light">Tổng tiền (VNĐ)</th>
                                <th class="text-center bg-light"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="bill in listBillEligibleForReturn">
                                <td>{{bill.billId}}</td>
                                <td>{{bill.customers.fullName}}</td>
                                <td>{{bill.customers.phone}}</td>
                                <td>{{bill.users.fullName}}</td>
                                <td class="text-end">{{bill.totalMoney | currency:"":0}}</td>
                                <td class="d-flex justify-content-center">
                                    <!-- Button trigger modal -->
                                    <button ng-click="openModalReturn(bill.billId)" type="button"
                                        class="btn btn-outline-primary rounded-pill">
                                        Chọn
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                <!-- <button type="button" class="btn btn-primary">Understood</button> -->
            </div>
        </div>
    </div>
</div>


<!-- productReturnModal -->
<div class="modal fade" id="productReturnModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div ng-show="isLoadingModal" class="loading">
        <div class="spinner-border text-primary spinner-center" role="status">
        </div>
    </div>
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Chọn sản phẩm trả</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive border rounded row mt-5" style="height: 350px; overflow: auto;">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" ng-model="selectedAllBillDetail"
                                        ng-click="clickSelectAllBillDetailNew(selectedAllBillDetail)">
                                </th>
                                <th>Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá</th>
                                <th>Thuế (%)</th>
                                <th>Tổng tiền (VNĐ)</th>
                                <th>Ghi chú</th>
                                <th>Hiện trạng sản phẩm</th>
                                <th>Hình thức đổi trả</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="detail in listBillDetail">
                                <td><input type="checkbox" name="billDetailcheckbox" value="{{detail}}"
                                        ng-click="changeCheckboxNew()">
                                </td>
                                <td>{{detail.productVariants.products.productName}}</td>
                                <td style="width: 5rem;">
                                    <input style="width: 2rem;" type="number" ng-model-options="{debounce : 500}"
                                        ng-if="detail.checkEnable"
                                        ng-model="dynamicQuantityReturn(detail.detailBillId).quantityReturn"
                                        ng-change="changeQuantityReturn(detail.detailBillId, dynamicQuantityReturn(detail.detailBillId).quantityReturn)">
                                    <input style="width: 2rem;" type="number" ng-model-options="{debounce : 500}"
                                        ng-if="!detail.checkEnable"
                                        ng-model="dynamicQuantityReturn(detail.detailBillId).quantityReturn" disabled> /
                                    {{detail.quantity}}
                                    <br>
                                    <span class="mt-3"
                                        style="color: red; font-style: italic;">{{listMessage[$index].quantity}}</span>
                                </td>
                                <td>{{detail.price | currency:"":0}}</td>
                                <td>{{detail.tax}}</td>
                                <td>{{detail.totalMoney | currency:"":0}}</td>
                                <td>
                                    <div class="form-floating" ng-if="detail.checkEnable">
                                        <textarea ng-model="dynamicQuantityReturn(detail.detailBillId).note"
                                            class="form-control" id="floatingTextarea" rows="20"></textarea>
                                        <label for="floatingTextarea">Note</label>
                                    </div>
                                    <div class="form-floating" ng-if="!detail.checkEnable">
                                        <textarea ng-model="dynamicQuantityReturn(detail.detailBillId).note"
                                            class="form-control" id="floatingTextarea" rows="20" disabled></textarea>
                                        <label for="floatingTextarea">Note</label>
                                    </div>
                                    <span class="mt-3"
                                        style="color: red; font-style: italic;">{{listMessage[$index].note}}</span>
                                </td>
                                <td>
                                    <div ng-repeat="de in detail.billDetails">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType"
                                            ng-if="detail.checkEnable">
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType"
                                            ng-if="!detail.checkEnable" disabled>
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            &emsp;</div>
                                    </div>
                                    <!-- <select class="form-select" convert-to-number ng-model="detail.returnType">
                                        <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                        <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                    </select> -->
                                </td>
                                <td style="width: 11rem;">
                                    <div ng-repeat="de in detail.billDetails">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-if="detail.checkEnable"
                                            ng-change="changeReturnKindNew($index, detail, de.returnKind)">
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProductNew($index, detail)"></i>
                                        </div>
                                    </div>
                                    <div ng-repeat="de in detail.billDetails" ng-if="!detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-change="changeReturnKindNew($index, detail, de.returnKind)" disabled>
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProductNew($index, detail)"></i>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-click="chooseProductChangeNew(detail)"
                                        ng-if="(!detail.checkBtnChoose) && detail.checkEnable">Chọn sản
                                        phẩm
                                    </button>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-if="detail.checkBtnChoose || !detail.checkEnable" disabled>Chọn sản phẩm
                                    </button>
                                    <span class="mt-3"
                                        style="color: red; font-style: italic;">{{listMessage[$index].chooseProduct}}</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-outline-primary" ng-click="btnReturn()">Trả hàng</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal Detail Bill Return-->
<div class="modal fade" id="detailBillReturn" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen modal-dialog-centered" ng-if="statusBill==2">
        <div ng-show="isLoadingModal" class="loading">
            <div class="spinner-border text-primary spinner-center" role="status">
            </div>
        </div>
        <div class="modal-content">
            <div ng-show="isLoading" class="loading">
                <div class="spinner-border text-primary spinner-center" role="status">
                </div>
            </div>
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">{{billId}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive rounded row mt-3" style="max-height: 550px; overflow: auto;">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th ng-if="statusBill==1"></th>
                                <th ng-if="statusBill==2">
                                    <input type="checkbox" ng-model="selectedAllBillDetail"
                                        ng-click="clickSelectAllBillDetail(selectedAllBillDetail)">
                                </th>
                                <th>Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá (VNĐ)</th>
                                <th>Thuế (%)</th>
                                <th>Tổng tiền (VNĐ)</th>
                                <th>Trạng thái</th>
                                <th>Ghi chú</th>
                                <th ng-if="statusBill==2">Hiện trạng sản phẩm</th>
                                <th ng-if="statusBill==2">Hình thức đổi trả</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat-start="detail in listBillDetailReturn">
                                <td ng-if="statusBill==1" style="width: 1rem;">
                                    <a ng-click="getProductVariantReturn(detail)" class="" data-bs-toggle="collapse"
                                        href="#collapseBillDetail_{{detail.detailBillId}}" role="button"
                                        aria-expanded="false" aria-controls="collapseExample"> <i
                                            class="bi bi-plus-circle"></i>
                                    </a>
                                </td>
                                <td ng-if="statusBill==2" style="width: 1rem;"><input type="checkbox"
                                        name="billDetailcheckbox" value="{{detail}}" ng-if="detail.status == 2"
                                        ng-click="changeCheckbox()">
                                </td>
                                <td style="width: 10rem;">{{detail.productVariants.products.productName}}</td>
                                <td class="text-end" style="width: 5rem;">{{detail.quantity}} </td>
                                <td class="text-end" style="width: 8rem;">{{detail.price | currency:"":0}}</td>
                                <td class="text-end" style="width: 5rem;">{{detail.tax | currency:"":0}}</td>
                                <td class="text-end" style="width: 8rem;">{{detail.totalMoney | currency:"":0}}</td>
                                <td style="width: 10rem;">
                                    <div class="bg-success text-center text-light rounded" ng-if="detail.status == 0">
                                        Không trả</div>
                                    <div class="bg-success text-center text-light rounded" ng-if="detail.status == 1">Đã
                                        trả</div>
                                    <div class="bg-warning text-center text-light rounded" ng-if="detail.status == 2">
                                        Chờ xác nhận trả</div>
                                    <div class="bg-danger text-center text-light rounded" ng-if="detail.status == 3">
                                        Không được trả</div>
                                </td>
                                <td style="width: 10rem;">{{detail.note}}</td>
                                <td ng-if="detail.status == 2" style="width: 17rem;">
                                    <div ng-repeat="de in detail.billDetails" ng-if="detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType">
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            &emsp;</div>
                                    </div>
                                    <div ng-repeat="de in detail.billDetails" ng-if="!detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType"
                                            disabled>
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            &emsp;</div>
                                    </div>
                                </td>
                                <td ng-if="detail.status == 2" style="width: 15rem;">
                                    <div ng-repeat="de in detail.billDetails" ng-if="detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-change="changeReturnKind($index, detail, de.returnKind)">
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProduct($index, detail)"></i>
                                        </div>
                                    </div>
                                    <div ng-repeat="de in detail.billDetails" ng-if="!detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-change="changeReturnKind($index, detail, de.returnKind)" disabled>
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProduct($index, detail)"></i>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-click="chooseProductChange(detail)"
                                        ng-if="(!detail.checkBtnChoose) && detail.checkEnable">Chọn sản
                                        phẩm
                                    </button>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-if="detail.checkBtnChoose || !detail.checkEnable" disabled>Chọn sản phẩm
                                    </button>
                                </td>
                            </tr>
                            <tr ng-repeat-end>
                                <td colspan="12">
                                    <div class="collapse" id="collapseBillDetail_{{detail.detailBillId}}">
                                        <div class="card card-body">
                                            <h6 class="text-center mb-1 fw-bold">Sản phẩm đổi trả</h6>

                                            <div class="table-responsive">
                                                <table class="table table-striped table-inverse text-nowrap">
                                                    <thead class="thead-inverse">
                                                        <th class="text-black-50">Tên sản phẩm</th>
                                                        <th class="text-black-50">Đơn giá</th>
                                                        <th class="text-black-50">Thuế</th>
                                                        <th class="text-black-50">Tổng tiền</th>
                                                        <th class="text-black-50">Ghi chú</th>
                                                        <th></th>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="detail in billDetailsStoreReturn">
                                                            <td>{{detail.productVariant.products.productName}}</td>
                                                            <td>{{detail.price}}</td>
                                                            <td>{{detail.tax}}</td>
                                                            <td>{{detail.totalMoney}}</td>
                                                            <td>{{detail.note}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>

                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-outline-danger" ng-click="btnReject()" ng-if="statusBill==2">Hủy
                    trả hàng</button>
                <button type="button" class="btn btn-outline-primary" ng-click="btnConfirm()" ng-if="statusBill==2">Xác
                    nhận trả hàng</button>
            </div>
        </div>
    </div>


    <div class="modal-dialog modal-xl modal-dialog-centered" ng-if="statusBill!=2">
        <div ng-show="isLoadingModal" class="loading">
            <div class="spinner-border text-primary spinner-center" role="status">
            </div>
        </div>
        <div class="modal-content">
            <div ng-show="isLoading" class="loading">
                <div class="spinner-border text-primary spinner-center" role="status">
                </div>
            </div>
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">{{billId}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive rounded row mt-3" style="max-height: 550px; overflow: auto;">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th ng-if="statusBill==1"></th>
                                <th ng-if="statusBill==2">
                                    <input type="checkbox" ng-model="selectedAllBillDetail"
                                        ng-click="clickSelectAllBillDetail(selectedAllBillDetail)">
                                </th>
                                <th>Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá (VNĐ)</th>
                                <th>Thuế (%)</th>
                                <th>Tổng tiền (VNĐ)</th>
                                <th>Trạng thái</th>
                                <th>Nhân viên xác nhận</th>
                                <th>Ghi chú</th>
                                <th ng-if="statusBill==2">Hiện trạng sản phẩm</th>
                                <th ng-if="statusBill==2">Hình thức đổi trả</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat-start="detail in listBillDetailReturn">
                                <td ng-if="statusBill==1" style="width: 1rem;">
                                    <a ng-click="getProductVariantReturn(detail)" class="" data-bs-toggle="collapse"
                                        href="#collapseBillDetail_{{detail.detailBillId}}" role="button"
                                        aria-expanded="false" aria-controls="collapseExample"> <i
                                            class="bi bi-plus-circle"></i>
                                    </a>
                                </td>
                                <td ng-if="statusBill==2" style="width: 1rem;"><input type="checkbox"
                                        name="billDetailcheckbox" value="{{detail}}" ng-if="detail.status == 2"
                                        ng-click="changeCheckbox()">
                                </td>
                                <td style="width: 10rem;">{{detail.productVariants.products.productName}}</td>
                                <td class="text-end" style="width: 5rem;">{{detail.quantity}} </td>
                                <td class="text-end" style="width: 8rem;">{{detail.price | currency:"":0}}</td>
                                <td class="text-end" style="width: 5rem;">{{detail.tax | currency:"":0}}</td>
                                <td class="text-end" style="width: 8rem;">{{detail.totalMoney | currency:"":0}}</td>
                                <td style="width: 10rem;">
                                    <div class="bg-success text-center text-light rounded" ng-if="detail.status == 0">
                                        Không trả</div>
                                    <div class="bg-success text-center text-light rounded" ng-if="detail.status == 1">Đã
                                        trả</div>
                                    <div class="bg-warning text-center text-light rounded" ng-if="detail.status == 2">
                                        Chờ xác nhận trả</div>
                                    <div class="bg-danger text-center text-light rounded" ng-if="detail.status == 3">
                                        Không được trả</div>
                                </td>
                                <td style="width: 10rem;">{{detail.userConfirm.fullName}}</td>
                                <td style="width: 10rem;">{{detail.note}}</td>
                                <td ng-if="detail.status == 2" style="width: 17rem;">
                                    <div ng-repeat="de in detail.billDetails" ng-if="detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType">
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            &emsp;</div>
                                    </div>
                                    <div ng-repeat="de in detail.billDetails" ng-if="!detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnType"
                                            disabled>
                                            <option class="text-warp" value="0">Sản phẩm lỗi</option>
                                            <option class="text-warp" value="1">Sản phẩm đổi trả</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            &emsp;</div>
                                    </div>
                                </td>
                                <td ng-if="detail.status == 2" style="width: 15rem;">
                                    <div ng-repeat="de in detail.billDetails" ng-if="detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-change="changeReturnKind($index, detail, de.returnKind)">
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProduct($index, detail)"></i>
                                        </div>
                                    </div>
                                    <div ng-repeat="de in detail.billDetails" ng-if="!detail.checkEnable">
                                        <select class="form-select mt-1" convert-to-number ng-model="de.returnKind"
                                            ng-change="changeReturnKind($index, detail, de.returnKind)" disabled>
                                            <option class="text-warp" value="0">Đổi sản phẩm</option>
                                            <option class="text-warp" value="1">Hoàn tiền</option>
                                        </select>
                                        <div
                                            ng-if="de.billDetailReturn.productVariants.products.productName && de.returnKind == 0">
                                            {{de.billDetailReturn.productVariants.products.productName}}&emsp;&emsp;&emsp;<i
                                                class="bi bi-x" ng-click="deleteProduct($index, detail)"></i>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-click="chooseProductChange(detail)"
                                        ng-if="(!detail.checkBtnChoose) && detail.checkEnable">Chọn sản
                                        phẩm
                                    </button>
                                    <button class="btn btn-primary mt-2 form-control"
                                        ng-if="detail.checkBtnChoose || !detail.checkEnable" disabled>Chọn sản phẩm
                                    </button>
                                </td>
                            </tr>
                            <tr ng-repeat-end>
                                <td colspan="12">
                                    <div class="collapse" id="collapseBillDetail_{{detail.detailBillId}}">
                                        <div class="card card-body">
                                            <h6 class="text-center mb-1 fw-bold">Sản phẩm đổi trả</h6>

                                            <div class="table-responsive">
                                                <table class="table table-striped table-inverse text-nowrap">
                                                    <thead class="thead-inverse">
                                                        <th class="text-black-50">Tên sản phẩm</th>
                                                        <th class="text-black-50">Đơn giá</th>
                                                        <th class="text-black-50">Thuế</th>
                                                        <th class="text-black-50">Tổng tiền</th>
                                                        <th class="text-black-50">Ghi chú</th>
                                                        <th></th>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="detail in billDetailsStoreReturn">
                                                            <td>{{detail.productVariant.products.productName}}</td>
                                                            <td>{{detail.price}}</td>
                                                            <td>{{detail.tax}}</td>
                                                            <td>{{detail.totalMoney}}</td>
                                                            <td>{{detail.note}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>

                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-outline-danger" ng-click="btnReject()" ng-if="statusBill==2">Hủy
                    trả hàng</button>
                <button type="button" class="btn btn-outline-primary" ng-click="btnConfirm()" ng-if="statusBill==2">Xác
                    nhận trả hàng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal chọn sản phẩm đổi -->
<div class="modal fade" id="chooseProductChange" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div ng-show="isLoading" class="loading">
            <div class="spinner-border text-primary spinner-center" role="status">
            </div>
        </div>
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Chọn sản phẩm muốn đổi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3 offset-9 mb-2">
                        <button class="btn btn-outline-success" ng-click="onOpenQRCode1()">Quét QR Code <i
                                class="bi bi-qr-code fw-bold"></i></button>
                    </div>
                    <div class="col-sm-12">
                    <input class="form-control" placeholder="Tìm kiếm sản phẩm" type="text"
                        ng-model="txtSearchProductVariant"
                        ng-change="searchProductVariantByName(txtSearchProductVariant)"
                        ng-click="clickSearch(txtSearchProductVariant)" ng-model-options="{debounce : 500}">
                    </div>
                    <div id="search"
                        class="output-complete has-add-new ng-hide list-group-flush pro row rounded mt-2 m-0"
                        style="background-color: rgb(247, 247, 247);height: 550px; overflow: auto;"
                        ng-show="lstProductVariant.length">
                        <ul class=" bg-light" style="position: sticky; top: 0;">
                            <li class="offset-11 col-1 rounded xBackground"
                                style="list-style-type: none; width: 16px; float: right;"><i class="bi bi-x-lg"
                                    ng-click="closeLstProVal()"></i>
                            </li>
                        </ul>
                        <ul ng-repeat="pro in lstProductVariant" ng-click="proValReturnChose(pro)" class="proVal">
                            <div class="row">
                                <li class="col-xl-7" style="list-style-type: none;">
                                    <b>{{pro.products.productName}}</b>
                                </li>
                                <li class="col-xl-2" style="list-style-type: none;">
                                    <p class="text-end" ng-if="pro.sales > 0" style="text-decoration: line-through;">
                                        {{pro.price
                                        |currency:"":0}}</p>
                                </li>
                                <li class="col-xl-3" style="list-style-type: none;">
                                    <p class="text-end" ng-if="pro.sales > 0">
                                        {{pro.price-pro.sales |currency:"":0}}</p>
                                    <p class="text-end" ng-if="pro.sales ==0">{{pro.price |
                                        currency:"":0}}</p>
                                </li>
                            </div>
                            <li style="list-style-type: none;">{{pro.skuId}}</li>
                            <li style="list-style-type: none;"><i style="color: rgb(151, 151, 151);">Quantity:</i>
                                {{pro.quantity | currency:"":0}}</li>
                        </ul>
                    </div>

                    <table class="table table-bordered mt-4" ng-if="EnableTable">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Đơn giá (VNĐ)</th>
                                <th>Thuế (%)</th>
                                <th>Tổng tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{proValReturn.products.productName}}</td>
                                <td><input type="number" class="form-control" ng-model="proValReturn.price"></td>
                                <td><input type="number" class="form-control" ng-model="proValReturn.tax"></td>
                                <td>{{proValReturn.price * (100 + proValReturn.tax) / 100 | number}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-outline-primary" ng-click="onChangeProduct(proValReturn)">Xác
                        nhận</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal chọn sản phẩm đổi new-->
<div class="modal fade" id="chooseProductChangeNew" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div ng-show="isLoading" class="loading">
            <div class="spinner-border text-primary spinner-center" role="status">
            </div>
        </div>
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Chọn sản phẩm muốn đổi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3 offset-9 mb-2">
                        <button class="btn btn-outline-success" ng-click="onOpenQRCode1()">Quét QR Code <i
                                class="bi bi-qr-code fw-bold"></i></button>
                    </div>
                    <input class="form-control" placeholder="Tìm kiếm sản phẩm" type="text"
                        ng-model="txtSearchProductVariant"
                        ng-change="searchProductVariantByName(txtSearchProductVariant)"
                        ng-click="clickSearch(txtSearchProductVariant)" ng-model-options="{debounce : 500}">
                    <div id="search"
                        class="output-complete has-add-new ng-hide list-group-flush pro row rounded mt-2 m-0"
                        style="background-color: rgb(247, 247, 247);height: 550px; overflow: auto;"
                        ng-show="lstProductVariant.length">
                        <ul class=" bg-light" style="position: sticky; top: 0;">
                            <li class="offset-11 col-1 rounded xBackground"
                                style="list-style-type: none; width: 16px; float: right;"><i class="bi bi-x-lg"
                                    ng-click="closeLstProVal()"></i>
                            </li>
                        </ul>
                        <ul ng-repeat="pro in lstProductVariant" ng-click="proValReturnChose(pro)" class="proVal">
                            <div class="row">
                                <li class="col-xl-7" style="list-style-type: none;">
                                    <b>{{pro.products.productName}}</b>
                                </li>
                                <li class="col-xl-2" style="list-style-type: none;">
                                    <p class="text-end" ng-if="pro.sales > 0" style="text-decoration: line-through;">
                                        {{pro.price
                                        |currency:"":0}}</p>
                                </li>
                                <li class="col-xl-3" style="list-style-type: none;">
                                    <p class="text-end" ng-if="pro.sales > 0">
                                        {{pro.price-pro.sales |currency:"":0}}</p>
                                    <p class="text-end" ng-if="pro.sales ==0">{{pro.price |
                                        currency:"":0}}</p>
                                </li>
                            </div>
                            <li style="list-style-type: none;">{{pro.skuId}}</li>
                            <li style="list-style-type: none;"><i style="color: rgb(151, 151, 151);">Quantity:</i>
                                {{pro.quantity | currency:"":0}}</li>
                        </ul>
                    </div>

                    <table class="table table-bordered mt-4" ng-if="EnableTable">
                        <thead>
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Đơn giá (VNĐ)</th>
                                <th>Thuế (%)</th>
                                <th>Tổng tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{proValReturn.products.productName}}</td>
                                <td><input type="number" class="form-control" ng-model="proValReturn.price"></td>
                                <td><input type="number" class="form-control" ng-model="proValReturn.tax"></td>
                                <td>{{proValReturn.price * (100 + proValReturn.tax) / 100 | number}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-outline-primary"
                        ng-click="onChangeProductNew(proValReturn)">Xác
                        nhận</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalCamereQR1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div ng-show="isLoading" class="loading">
                <div class="spinner-border text-primary spinner-center" role="status">
                </div>
            </div>
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">QR Code</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    ng-click="onCloseQRCode1()"></button>
            </div>
            <div class="modal-body">
                <div class="row m-0 mb-2">
                    <select class="form-select" ng-change="changeCamera1(camera)" ng-model="camera"
                        ng-options="cam as cam.name for cam in lstCamera track by cam.id">
                    </select>
                </div>
                <div>
                    <video class="m-0" id="preview1" width="100%" height="100%"></video>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                    ng-click="onCloseQRCode1()">Close</button>
            </div>
        </div>
    </div>
</div>